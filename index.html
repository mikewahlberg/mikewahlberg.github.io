<html>

<head>
  <script src="libs/three.js"></script>
	<script src="libs/physi.js"></script>
	<script src="libs/threex.keyboardstate.js"></script>
	<script src='libs/loaders/STLLoader.js'></script>
	<script src='libs/loaders/ColladaLoader.js'></script>
	<script src='libs/loaders/MTLLoader.js'></script>
	<script src='libs/loaders/OBJLoader.js'></script>
	<script src='libs/loaders/OBJMTLLoader.js'></script>
	<script src='libs/threex.universalloader.js'></script>
	<script src='libs/janda_manatee_solid_regular.typeface.js'></script>
</head>

<body>
  <script>
    var temporaryCube;
    var camera, scene, renderer, keyboard, loader, url, spotlight;
    var material, textGeom, textMesh;
    var score = 0, health = 100, damage = 0;

    function loadCube()
    {
      console.log("Loading cube.\n");
      var geo = new THREE.BoxGeometry(4, 4, 12);
      var mat = new THREE.MeshLambertMaterial({color: 'blue'}, .95, .95);
      temporaryCube = new THREE.Mesh(geo, mat);
      temporaryCube.position.x = 20;
      temporaryCube.position.y = 20;
      temporaryCube.position.z = 6;
      scene.add(temporaryCube);
    }

    function loadModel()
    {
      loader = new THREEx.UniversalLoader();
		  url = ['female02.obj', 'female.mtl'];
		  loader.load(url, function(object3d) {
			//scene.add(object3d);
			  render();
		  });
    }

    function generateWorld()
    {
      var texture = THREE.ImageUtils.loadTexture('assets/images/groundterrain.jpg');
      var planeMaterial = new THREE.MeshLambertMaterial({map: texture}, .4, .8);
      var planeGeometry = new THREE.PlaneGeometry(200, 200, 6);
      plane = new Physijs.BoxMesh( planeGeometry, planeMaterial, 0);
      scene.add(plane);
    }

    var numEnemies = 0;
    var waveNumber = 0;
    var waveCap = 2;
    function nextWave()
    {
      waveNumber++;
      damage++;
      numEnemies = Math.pow(2, waveNumber);
    }

    function init()
    {
      keyboard = new THREEx.KeyboardState();

      Physijs.scripts.worker = 'libs/physijs_worker.js';
      Physijs.scripts.ammo = 'ammo.js';

      scene = new Physijs.Scene();
      scene.setGravity(new THREE.Vector3(0, 0, -30));
      scene.addEventListener('update', function() {
        scene.simulate();
      });



      camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, .1, 10000);
      camera.position.x = 0;
      camera.position.y = -100;
      camera.position.z = 250;
      camera.lookAt(scene.position);

      renderer = new THREE.WebGLRenderer();
      renderer.setClearColor(0x0000000, 1.0);
      renderer.setSize( window.innerWidth, window.innerHeight);
      renderer.shadowMapEnabled = true;

      spotLight = new THREE.SpotLight( 0xffffff );
  		spotLight.position.set( 0, 0, 250 );
  		spotLight.shadowCameraNear = 10;
  		spotLight.shadowCameraFar = 100;
  		spotLight.castShadow = true;
  		spotLight.intensity = 4;
  		scene.add(spotLight);

      generateWorld();

      loadCube();

      scene.simulate();

      document.body.appendChild(renderer.domElement);
      render();
    }

    function render()
    {
      if(numEnemies == 0)
        nextWave();

      if(keyboard.pressed("w"))
      {
        console.log("Pressed 'w'\n");
        temporaryCube.position.y += .05;
      }
      else if(keyboard.pressed("s"))
      {
        console.log("Pressed 's'\n");
        temporaryCube.position.y -= .05;
      }
      else if(keyboard.pressed("d"))
      {
        console.log("Pressed 'd'\n");
        temporaryCube.position.x += .05;
      }
      else if(keyboard.pressed("a"))
      {
        console.log("Pressed 'a'\n");
        temporaryCube.position.x -= .05;
      }

      requestAnimationFrame(render);
      renderer.render(scene, camera);
    }

    window.onload = init;
  </script>
</body>

</html>
